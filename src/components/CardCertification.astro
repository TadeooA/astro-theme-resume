---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { cn } from '@/utils';

interface Props {
  institution: string;
  degree: string;
  fieldOfStudy?: string;
  period: string;
  isCompleted?: boolean;
  grade?: string;
  imagePath?: string;
  altText?: string;
  imageClass?: string;
  credentialId?: string;
  credentialUrl?: string;
}

const {
  institution,
  degree,
  fieldOfStudy,
  period,
  isCompleted = true,
  grade,
  imagePath,
  altText = `${institution} logo`,
  imageClass,
  credentialId,
  credentialUrl
} = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/*.{jpeg,jpg,png,gif,svg}');

if (imagePath && !images[imagePath]) {
  throw new Error(`"${imagePath}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif,svg}"`);
}

const containerClasses = cn(
  'rounded-2xl border-2 border-dashed bg-primary-foreground px-5 py-4',
  'transition-all hover:border-foreground/25 hover:shadow-sm',
  'dark:border-gray-500 dark:bg-neutral-950 dark:hover:border-gray-500',
  'flex flex-col items-center text-center gap-4'
);
---

<div class={containerClasses}>
  {imagePath && (
    <Image
      src={images[imagePath]()}
      alt={altText}
      class={cn('w-24 h-24 object-contain rounded-2xl', imageClass)}
      loading="eager"
      width={96}
      height={96}
    />
  )}

  <div class="flex flex-col gap-1">
    <h2 class="text-base font-semibold text-foreground dark:text-white">{degree}</h2>
    <p class="text-sm text-muted-foreground dark:text-white">{institution}</p>
    {fieldOfStudy && (
      <p class="text-sm text-muted-foreground dark:text-white">{fieldOfStudy}</p>
    )}
    <p class="text-sm text-muted-foreground dark:text-white">{period}</p>
    {credentialId && (
      <p class="text-xs text-gray-400 dark:text-gray-400">ID: {credentialId}</p>
    )}
    {credentialUrl && (
      <a href={credentialUrl} target="_blank" rel="noopener noreferrer" class="text-blue-500 font-semibold text-sm hover:underline">
        Ver Credencial
      </a>
    )}
  </div>
</div>
